{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"ESP ESP is an implementation of a Service Provider that wraps the Shibboleth SP 2 software. Authentication methods ESP provides to your software the capability to login with the italian SPID and CIE authentication methods.","title":"Overview"},{"location":"#esp","text":"ESP is an implementation of a Service Provider that wraps the Shibboleth SP 2 software.","title":"ESP"},{"location":"#authentication-methods","text":"ESP provides to your software the capability to login with the italian SPID and CIE authentication methods.","title":"Authentication methods"},{"location":"changelog/","text":"Changelog All notable changes to this project will be documented in this file. [21.2.0] - Unreleased Added Fixed security problems [21.1.1] - 2021-08-18 Added Initial release! \ud83c\udf89 \ud83c\udf89","title":"Changelog"},{"location":"changelog/#changelog","text":"All notable changes to this project will be documented in this file.","title":"Changelog"},{"location":"changelog/#2120-unreleased","text":"","title":"[21.2.0] - Unreleased"},{"location":"changelog/#added","text":"Fixed security problems","title":"Added"},{"location":"changelog/#2111-2021-08-18","text":"","title":"[21.1.1] - 2021-08-18"},{"location":"changelog/#added_1","text":"Initial release! \ud83c\udf89 \ud83c\udf89","title":"Added"},{"location":"configuration/","text":"Configuration In order to use the Esp to provide SPID/CIE capability to your software, you need to perform the following activities: Assessment During the assessment phase, all the information and data are collected that must be communicated to AgID (SPID) or Istituto Poligrafico (CIE) via e-mail and entered in the metadata, that is the configuration file for the service. Furthermore, the required security level (L1 - L2 - L3 for SPID OR L3 for CIE) and the set of SPID/CIE attributes required during authentication (BASIC or FULL according to the SPID attributes table or eIDAS Minimum set for CIE). Setup Test Environment Namirial will prepare the test environment and start the verifications based on the data provided and will send to the customer the accesses for the Test environment, together with: SSL certified (for each aggregate if needed); Dedicated endpoints of the API and for the redirect of the user during the SPID authentication phase (for each aggregate if needed); Test metadata to be published on a URL in https: // relating to the customer domain. This URL will be indicated in the SPID/CIE membership request email to be sent to the SPID/CIE Technical Institute (for each aggregate if needed). Once the integration phase has been completed and the correct functioning on the customer side has been ascertained, Namirial will take care of communications with SPID/CIE Technical Institute for testing the environment, requesting, on behalf of the customer, to join SPID/CIE as a Service Provider. Testing SPID/CIE Technical Institute will carry out the tests both on the adherence of the SAML SPID protocol (carried out within ESP), and on the creation of the customer portal that integrates ESP, outside the Namirial perimeter. It will communicate any requests for clarification, discrepancies and so on to the technical reference indicated by Namirial. Deploy in production SPID Namirial, for each private and aggregator customer, deals with the generation of the CSR file (Certificate Signing Request), for the purpose of compiling the Registration Request document, since it is necessary to make a request to generate a production Electronic Seal certificate to the AgID to be used in the application. of ESP production. In the PDF Registration Request, it is by Namirial to fill in the fields: As; Type of Certificate; CSR hash described in the AgID procedure to be included in the Registration Request; The Customer must send the AgID a second certified email (on which he will receive more detailed information), with a ZIP file attached; the PDF of the Registration Request, signed by the legal representative and in PAdES format; the CSR generated by Namirial. When the certificate is ready, the customer should send it to Namirial. After that Namirial signs the metadata with this certificate and it sends it to Agid. Deploy in production CIE If the tests have been successful, Istituto Poligrafico requests a series of screenshot that certificates the test environment. After that the CIE tech team integrates your informations to the prod CIE identity provider. Go live! Service Provider are now live, now your users can authenticate to your application with SPID or CIE.","title":"Getting started"},{"location":"configuration/#configuration","text":"In order to use the Esp to provide SPID/CIE capability to your software, you need to perform the following activities:","title":"Configuration"},{"location":"configuration/#assessment","text":"During the assessment phase, all the information and data are collected that must be communicated to AgID (SPID) or Istituto Poligrafico (CIE) via e-mail and entered in the metadata, that is the configuration file for the service. Furthermore, the required security level (L1 - L2 - L3 for SPID OR L3 for CIE) and the set of SPID/CIE attributes required during authentication (BASIC or FULL according to the SPID attributes table or eIDAS Minimum set for CIE).","title":"Assessment"},{"location":"configuration/#setup-test-environment","text":"Namirial will prepare the test environment and start the verifications based on the data provided and will send to the customer the accesses for the Test environment, together with: SSL certified (for each aggregate if needed); Dedicated endpoints of the API and for the redirect of the user during the SPID authentication phase (for each aggregate if needed); Test metadata to be published on a URL in https: // relating to the customer domain. This URL will be indicated in the SPID/CIE membership request email to be sent to the SPID/CIE Technical Institute (for each aggregate if needed). Once the integration phase has been completed and the correct functioning on the customer side has been ascertained, Namirial will take care of communications with SPID/CIE Technical Institute for testing the environment, requesting, on behalf of the customer, to join SPID/CIE as a Service Provider.","title":"Setup Test Environment"},{"location":"configuration/#testing","text":"SPID/CIE Technical Institute will carry out the tests both on the adherence of the SAML SPID protocol (carried out within ESP), and on the creation of the customer portal that integrates ESP, outside the Namirial perimeter. It will communicate any requests for clarification, discrepancies and so on to the technical reference indicated by Namirial.","title":"Testing"},{"location":"configuration/#deploy-in-production-spid","text":"Namirial, for each private and aggregator customer, deals with the generation of the CSR file (Certificate Signing Request), for the purpose of compiling the Registration Request document, since it is necessary to make a request to generate a production Electronic Seal certificate to the AgID to be used in the application. of ESP production. In the PDF Registration Request, it is by Namirial to fill in the fields: As; Type of Certificate; CSR hash described in the AgID procedure to be included in the Registration Request; The Customer must send the AgID a second certified email (on which he will receive more detailed information), with a ZIP file attached; the PDF of the Registration Request, signed by the legal representative and in PAdES format; the CSR generated by Namirial. When the certificate is ready, the customer should send it to Namirial. After that Namirial signs the metadata with this certificate and it sends it to Agid.","title":"Deploy in production SPID"},{"location":"configuration/#deploy-in-production-cie","text":"If the tests have been successful, Istituto Poligrafico requests a series of screenshot that certificates the test environment. After that the CIE tech team integrates your informations to the prod CIE identity provider.","title":"Deploy in production CIE"},{"location":"configuration/#go-live","text":"Service Provider are now live, now your users can authenticate to your application with SPID or CIE.","title":"Go live!"},{"location":"integrations/getkey/","text":"Get Key This endpoint return a session key that should be used to start a authentication process with SPID or CIE. The following http GET call must be made to start the authentication round. Since the call is protected, the ssl certificate provided during Assessment must be used. GET sslprotected/environment_name/getKey.php Parameters Name Description domain_uri The ESP domain uri environment_name The environment path level It's the authentication level (L1-L2-L3) attributes It's the attribute level (Base-Full) Result The response of the api is a string that must be used in the login at the authnKey parameter.","title":"Get key"},{"location":"integrations/getkey/#get-key","text":"This endpoint return a session key that should be used to start a authentication process with SPID or CIE. The following http GET call must be made to start the authentication round. Since the call is protected, the ssl certificate provided during Assessment must be used. GET sslprotected/environment_name/getKey.php","title":"Get Key"},{"location":"integrations/getkey/#parameters","text":"Name Description domain_uri The ESP domain uri environment_name The environment path level It's the authentication level (L1-L2-L3) attributes It's the attribute level (Base-Full)","title":"Parameters"},{"location":"integrations/getkey/#result","text":"The response of the api is a string that must be used in the login at the authnKey parameter.","title":"Result"},{"location":"integrations/login/","text":"Login The next step is to authenticate with the service you are integrating (SPID/CIE) then you have to build an address formed by different parameters. GET environment_name/login_file.php Parameters Name Description domain_uri The ESP domain uri environment_name The environment path login_file The login file used for the authentication (like cielogin-spidlogin) final_url It's the redirect url called at the end of the authentication process (It should be comunicated during the assessment phase) level It's the authentication level (L1-L2-L3) attributes It's the attribute level (Base-Full) authnKey It's the authn key that has been given at the getkey endpoint Result The address that is constructed must then be copied and pasted into the address bar of a browser. The page that opens can be - login screen with SPID - login screen with CIE Login Succeded After a succeded login the user will be redirected to the final url parameter. The parameters that will be returned with querystring should be: a session id and user key parameter, if the configuration has redirect type set to TOKEN . Now you have to call the token API, if you want the JSON Web Token a jwt token parameter, if the configuration has redirect type set to JWT . Now you have the JWT with the user info. You can see an example of this JWT at the token section.","title":"Perform a login"},{"location":"integrations/login/#login","text":"The next step is to authenticate with the service you are integrating (SPID/CIE) then you have to build an address formed by different parameters. GET environment_name/login_file.php","title":"Login"},{"location":"integrations/login/#parameters","text":"Name Description domain_uri The ESP domain uri environment_name The environment path login_file The login file used for the authentication (like cielogin-spidlogin) final_url It's the redirect url called at the end of the authentication process (It should be comunicated during the assessment phase) level It's the authentication level (L1-L2-L3) attributes It's the attribute level (Base-Full) authnKey It's the authn key that has been given at the getkey endpoint","title":"Parameters"},{"location":"integrations/login/#result","text":"The address that is constructed must then be copied and pasted into the address bar of a browser. The page that opens can be - login screen with SPID - login screen with CIE","title":"Result"},{"location":"integrations/login/#login-succeded","text":"After a succeded login the user will be redirected to the final url parameter. The parameters that will be returned with querystring should be: a session id and user key parameter, if the configuration has redirect type set to TOKEN . Now you have to call the token API, if you want the JSON Web Token a jwt token parameter, if the configuration has redirect type set to JWT . Now you have the JWT with the user info. You can see an example of this JWT at the token section.","title":"Login Succeded"},{"location":"integrations/token/","text":"Token Once the authentication with the IDP service is done, ESP takes care of making a redirect to the final_url specified in the login call, with two parameters the key and id that refer to the user's session on ESP. The third method allows receiving a JWT token containing the user's information. GET sslprotected/environment_name/getUser.php Parameters Name Description ID The ESP user identifier key The ESP session key The JWT is a signed token that contains the user information. Signed tokens can verify the integrity of the claims contained within it. JSON Web Tokens are a good way of securely transmitting information between parties. A sample of GET-USER-JWT content is the following: { \"dateOfBirth\" : \"1900-11-19\" , \"domicileMunicipality\" : \"ANCONA\" , \"domicileNation\" : \"IT\" , \"placeOfBirth\" : \"A271\" , \"expirationDate\" : \"2023-09-10\" , \"domicileStreetAddress\" : \"via sample, 11\" , \"familyName\" : \"ROSSI\" , \"mobilePhone\" : \"00393400000000\" , \"address\" : \"via sample, 11 60120 ANCONA AN\" , \"email\" : \"m.rossi@email.com\" , \"domicilePostalCode\" : \"60120\" , \"name\" : \"MARIO\" , \"countyOfBirth\" : \"AN\" , \"spidCode\" : \"NAMI0000000000\" , \"gender\" : \"M\" , \"fiscalNumber\" : \"TINIT-RSSMRA00S19A271B\" , \"domicileProvince\" : \"AN\" , \"digitalAddress\" : \"\" , \"idCard\" : \"\" , \"level\" : null , \"reqId\" : \"_e709d704aa3b47eda307203119a987ac\" , \"assertionId\" : \"_71ce2354dd3222a0db8477dcb1441fec\" } You can check from the JWT content using the jwt-io-debugger . You can copy and paste the token and you can see its content.","title":"Get user token"},{"location":"integrations/token/#token","text":"Once the authentication with the IDP service is done, ESP takes care of making a redirect to the final_url specified in the login call, with two parameters the key and id that refer to the user's session on ESP. The third method allows receiving a JWT token containing the user's information. GET sslprotected/environment_name/getUser.php","title":"Token"},{"location":"integrations/token/#parameters","text":"Name Description ID The ESP user identifier key The ESP session key The JWT is a signed token that contains the user information. Signed tokens can verify the integrity of the claims contained within it. JSON Web Tokens are a good way of securely transmitting information between parties. A sample of GET-USER-JWT content is the following: { \"dateOfBirth\" : \"1900-11-19\" , \"domicileMunicipality\" : \"ANCONA\" , \"domicileNation\" : \"IT\" , \"placeOfBirth\" : \"A271\" , \"expirationDate\" : \"2023-09-10\" , \"domicileStreetAddress\" : \"via sample, 11\" , \"familyName\" : \"ROSSI\" , \"mobilePhone\" : \"00393400000000\" , \"address\" : \"via sample, 11 60120 ANCONA AN\" , \"email\" : \"m.rossi@email.com\" , \"domicilePostalCode\" : \"60120\" , \"name\" : \"MARIO\" , \"countyOfBirth\" : \"AN\" , \"spidCode\" : \"NAMI0000000000\" , \"gender\" : \"M\" , \"fiscalNumber\" : \"TINIT-RSSMRA00S19A271B\" , \"domicileProvince\" : \"AN\" , \"digitalAddress\" : \"\" , \"idCard\" : \"\" , \"level\" : null , \"reqId\" : \"_e709d704aa3b47eda307203119a987ac\" , \"assertionId\" : \"_71ce2354dd3222a0db8477dcb1441fec\" } You can check from the JWT content using the jwt-io-debugger . You can copy and paste the token and you can see its content.","title":"Parameters"}]}